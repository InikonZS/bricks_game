(()=>{"use strict";var t=function(){return(t=Object.assign||function(t){for(var o,n=1,i=arguments.length;n<i;n++)for(var e in o=arguments[n])Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e]);return t}).apply(this,arguments)},o=function(){function o(t,o,e){var r=this;this.field=new n(t,o,e),this.stackList=new i(t,o,e),this.field.onReverted=function(t){var o=r.stackList.stacks.find((function(o){return o.initialPosition.x==t.position.x&&o.initialPosition.y==t.position.y&&o.direction==[0,4,3,2,1][t.direction]}));o&&o.push(t.color)}}return o.prototype.move=function(o){var n=this.stackList.stacks[o];console.log(n.initialPosition),this.field.cells.find((function(t){return(1==n.direction||4==n.direction)&&t.position.x==n.initialPosition.x||(2==n.direction||3==n.direction)&&t.position.y==n.initialPosition.y}))&&this.field.putCell(new r(n.pop(),n.direction,t({},n.initialPosition)))},o.prototype.processMove=function(){for(var t=0;t<1e4;t++)if(!this.field.processStep())return;throw new Error("Max iterations, break")},o.prototype.checkFigure=function(t){},o}(),n=function(){function t(t,o,n){this.cells=[],this.width=t,this.height=o;for(var i=0;i<10;i++){var e=new r(Math.floor(Math.random()*n),0,{x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*o)});this.putCell(e)}}return t.prototype.putCell=function(t){return this.cells.push(t),t},t.prototype.revertCell=function(t){return this.cells=this.cells.filter((function(o){return o!=t})),t},t.prototype.processStep=function(){var t=this,o=!1;return this.cells.forEach((function(n){var i=n.getNextPosition();null==t.cells[t.getIndex(i.x,i.y)]&&(i.x>=0&&i.y>=0&&i.x<t.width&&i.y<t.height?n.position=i:(t.revertCell(n),t.onReverted(n)),o=!0)})),0==o&&this.cells.forEach((function(n){var i=t.checkFigure(n.position,n.color);i.length>3&&(t.removeFigure(i),o=!0)})),o},t.prototype.getIndex=function(t,o){return this.cells.findIndex((function(n){return n.position.x==t&&n.position.y==o}))},t.prototype.checkFigure=function(t,o){var n=this,i=this.cells.map((function(t){return{color:t.color,generation:99999}})),e=[{x:0,y:1},{x:1,y:0},{x:-1,y:0},{x:0,y:-1}],r=function(t,c,s){var l=[];return t.forEach((function(t){e.forEach((function(e){var r={x:t.x+e.x,y:t.y+e.y},u=i[n.getIndex(r.x,r.y)];u&&u.generation>c&&u.color==o&&(l.push(r),u.generation=c,s.push(r))}))})),l.length?r(l,c+1,s):s};return r([t],0,[])},t.prototype.removeFigure=function(t){var o=this,n=[];t.forEach((function(t){var i=o.cells[o.getIndex(t.x,t.y)];i&&n.push(i)})),this.cells=this.cells.filter((function(t){return!n.includes(t)}))},t}(),i=function(){function t(t,o,n){this.stacks=[];for(var i=0;i<2*(t+o);i++){var r=new e,c=this.getDirection(i,t,o);r.direction=c,r.initialPosition=this.getInitial(i,t,o);for(var s=0;s<3;s++)r.push(Math.floor(Math.random()*n));this.stacks.push(r)}}return t.prototype.getDirection=function(t,o,n){return t<o?1:t<o+n?2:t<2*o+n?3:4},t.prototype.getInitial=function(t,o,n){return t<o?{x:Math.floor(t%o),y:0}:t<o+n?{x:0,y:Math.floor((t-o)%n)}:t<2*o+n?{x:o-1,y:Math.floor((t-o-n)%n)}:{x:Math.floor(t%o),y:n-1}},t}(),e=function(){function t(){this.cells=[]}return t.prototype.pop=function(){var t=this.cells.pop();return this.cells.unshift(Math.floor(3*Math.random())),t},t.prototype.push=function(t){return this.cells=this.cells.slice(this.cells.length-2),this.cells.push(t)},t}(),r=function(){function t(t,o,n){this._color=t,this._direction=o,this.position=n}return t.prototype.setDirection=function(t){this._direction=t},t.prototype.getNextPosition=function(){var t=[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:-1,y:0},{x:0,y:-1}][this._direction];return{x:this.position.x+t.x,y:this.position.y+t.y}},Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),t}();const c=function(t,o,n,i){void 0===o&&(o="div"),void 0===n&&(n=""),void 0===i&&(i="");var e=document.createElement(o);e.className=n,e.textContent=i,t&&t.append(e),this.node=e};var s,l=(s=function(t,o){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])})(t,o)},function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}s(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}),u=function(t){function o(n,i){for(var e=t.call(this,n,"div","grid_wrapper")||this,r=[],s=0;s<9;s++)r.push(new c(e.node,"div","grid_zone"));for(var l=function(t){var n=new c(r[[1,3,5,7][t-1]].node,"div",1==t||4==t?"row":"row row__vertical");i.stackList.stacks.forEach((function(e,r){if(e.direction==t){var s=new c(n.node,"div",2==t||3==t?"row":"row row__vertical");e.cells.forEach((function(n,l){var u=new c(s.node,"div","cell");u.node.textContent=e.direction.toString(),u.node.onclick=function(){i.move(r),i.processMove(),document.querySelector("#app").innerHTML="",new o(document.querySelector("#app"),i)},u.node.onmouseover=function(){a[e.initialPosition.y][e.initialPosition.x].node.style.borderWidth="3px"},u.node.onmouseout=function(){a[e.initialPosition.y][e.initialPosition.x].node.style.borderWidth=""},u.node.style.backgroundColor=["#f99","#9f9","#99f","#f9f"][e.cells[2==t||1==t?l:e.cells.length-1-l]]}))}}))},u=1;u<=4;u++)l(u);var a=[],f=new c(r[4].node);for(s=0;s<10;s++){for(var p=new c(f.node,"div","row"),h=[],d=0;d<10;d++){var y=new c(p.node,"div","cell");h.push(y)}a.push(h)}return i.field.cells.forEach((function(t){var o=a[t.position.y][t.position.x];o.node.style.backgroundColor=["#f99","#9f9","#99f","#f9f"][t.color],o.node.textContent=t.direction.toString()})),e}return l(o,t),o}(c),a=new o(10,10,3);new u(document.querySelector("#app"),a),window.app=a,console.log("App started")})();
//# sourceMappingURL=main.js.map